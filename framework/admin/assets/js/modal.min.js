if(typeof Object.create!=="function"){Object.create=function(b){function a(){}a.prototype=b;return new a()}}(function(b){var a={init:function(e,f){var c=this;c.elem=f;c.$elem=b(f);c.options=b.extend({},b.fn.ThemeBlvdModal.options,e);for(var d in c.options){if(c.$elem.data(d)){c.options[d]=c.$elem.data(d)}}c.target=c.$elem.data("target");c.$target=b("#"+c.target);if(c.$elem.parent().is(".content-block-nav")){c.options.button_delete=themeblvd.delete_text}c.$elem.on("click",function(){c.popup="";c.id=c.target;if(c.options.build){c.id+="_build";c.build()}c.$modal_window=b("#"+c.id);if(c.options.padding){c.$modal_window.find(".media-frame-content-inner").css("padding","20px")}c.options.on_load.call(c);c.$modal_window.find(".media-modal-close, .media-modal-backdrop").on("click",function(){c.options.on_cancel.call(c);c.close();return false});c.$modal_window.find(".media-button-insert").on("click",function(){c.options.on_save.call(c);c.save();c.close();return false});if(c.options.button_delete){var g=c.$elem.parent().is(".content-block-nav")?themeblvd.delete_block:themeblvd.delete_item;c.$modal_window.find(".media-button-delete").on("click",function(){tbc_confirm(g,{confirm:true},function(h){if(h){c.options.on_delete.call(c);if(c.$elem.parent().is(".content-block-nav")){c.delete_block()}c.close()}});return false})}c.display();return false})},build:function(){var d=this,f,c='<div id="%id%" class="themeblvd-modal-wrap" style="display:none;">                                 <div class="themeblvd-modal %size%-modal media-modal wp-core-ui hide">                                     <a class="media-modal-close" href="#" title="Close">                                         <span class="media-modal-icon"></span>                                     </a>                                     <div class="media-modal-content">                                         <div class="media-frame wp-core-ui hide-menu hide-router">                                             <div class="media-frame-title">                                                 <h1>%title%</h1>                                             </div><!-- .media-frame-title (end) -->                                             <div class="media-frame-content">                                                 <div class="media-frame-content-inner">                                                     <div class="content-mitt">                                                         %content%                                                     </div>                                                 </div><!-- .media-frame-content-inner (end) -->                                             </div><!-- .media-frame-content (end) -->                                             <div class="media-frame-toolbar">                                                 <div class="media-toolbar">                                                     <div class="media-toolbar-primary">                                                         <a href="#" class="button media-button button-primary button-large media-button-insert">%button_text%</a>                                                     </div>                                                 </div><!-- .media-toolbar (end) -->                                             </div><!-- .media-frame-toolbar (end) -->                                         </div><!-- .media-frame (end) -->                                     </div><!-- .media-modal-content (end) -->                                  </div><!-- .themeblvd-modal (end) -->                                  <div class="media-modal-backdrop"></div>                              </div>';d.popup=c;d.popup=d.popup.replace("%id%",d.id);d.popup=d.popup.replace("%size%",d.options.size);d.popup=d.popup.replace("%title%",d.options.title);d.popup=d.popup.replace("%button_text%",d.options.button);if(d.options.code_editor){d.popup=d.popup.replace("%content%",'<form><textarea id="'+d.id+'-editor" name="code"></textarea></form>')}if(d.options.form){d.popup=d.popup.replace("%content%",'<div id="optionsframework"></div>')}b("body").append(d.popup);if(d.options.button_delete){b("#"+d.id+" .media-toolbar").prepend('<div class="media-toolbar-secondary"><a href="#" class="button media-button button-secondary button-large media-button-delete">'+d.options.button_delete+"</a></div>")}if(d.options.code_editor){if(d.$elem.is(".tb-content-block-code-link")){var e=d.$elem.closest(".content-block").data("field-name");f=d.$elem.closest(".content-block").find('textarea[name="'+e+'[content]"]').val()}else{f=d.$elem.closest(".textarea-wrap").find("textarea").val()}b("#"+d.id+"-editor").val(f)}else{d.$target.after('<div id="'+d.id+'_marker"></div>');if(d.options.form){b("#"+d.id).find("#optionsframework").append(d.$target)}else{b("#"+d.id).find(".content-mitt").append(d.$target)}}},display:function(){var d=this,c;b("body").addClass("themeblvd-stop-scroll");d.$modal_window.show();if(d.options.code_editor&&typeof CodeMirror!=="undefined"){var f;if(d.options.code_lang=="css"||d.options.code_lang=="javascript"){f=d.options.code_lang}else{f={name:"htmlmixed",scriptTypes:[{matches:/\/x-handlebars-template|\/x-mustache/i,mode:null},{matches:/(text|application)\/(x-)?vb(a|script)/i,mode:"vbscript"}]}}var e=CodeMirror.fromTextArea(document.getElementById(d.id+"-editor"),{mode:f,lineNumbers:true,theme:"themeblvd",indentUnit:4,tabSize:4,indentWithTabs:true,autofocus:true});if(e){b("#"+d.id+"-editor").data("CodeMirrorInstance",e)}}if(this.options.size!="large"){c=d.$modal_window.find(".media-frame-content-inner").outerHeight();c=57+c+60;if(d.options.code_editor){c+=2}else{c+=10}d.$modal_window.find(".themeblvd-modal").css("max-height",c+"px")}},close:function(){var c=this;if(c.options.build){b("#"+c.id+"_marker").after(c.$target).remove()}c.$modal_window.find(".media-modal-close, .media-modal-backdrop").off("click");c.$modal_window.find(".media-button-insert").off("click");if(c.options.build){c.$modal_window.remove()}else{c.$modal_window.hide()}b("body").removeClass("themeblvd-stop-scroll")},save:function(){var d=this;if(d.options.code_editor){var e=b("#"+d.id+"-editor").data("CodeMirrorInstance"),g=e.getValue(),c;if(d.$elem.is(".tb-content-block-code-link")){var f=d.$elem.closest(".content-block").data("field-name");c=d.$elem.closest(".content-block").find('textarea[name="'+f+'[content]"]')}else{c=d.$elem.closest(".textarea-wrap").find("textarea")}c.val(g)}},delete_block:function(){var d=this,e,c="";e=d.$elem.closest(".column-blocks");if(d.$elem.parent().is(".content-block-nav")){d.$elem.closest(".content-block").remove()}if(!e.html().trim().length){e.addClass("mini-empty")}}};b.fn.ThemeBlvdModal=function(c){return this.each(function(){var d=Object.create(a);d.init(c,this)})};b.fn.ThemeBlvdModal.options={title:"Setup",button:"Save",button_delete:"",size:"large",build:true,form:false,code_editor:false,code_lang:"html",padding:false,send_back:null,on_load:function(c){},on_cancel:function(c){},on_save:function(c){},on_delete:function(c){}}})(jQuery);